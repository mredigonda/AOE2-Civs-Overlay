<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Age of Empires II Civilization Selector</title>
        <link rel="stylesheet" href="./civ-selector.css" />
    </head>
    <body>
        <div
            id="drag-handle"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                height: 30px;
                background: rgba(0, 0, 0, 0.1);
                cursor: move;
                z-index: 9999;
                -webkit-app-region: drag;
            "
        ></div>
        <div id="app">
            <p>Loading civ-selector...</p>
        </div>
        <div
            id="civ-info"
            style="
                display: none;
                color: white;
                font-family: Arial, sans-serif;
                font-size: 14px;
                line-height: 1.4;
                pointer-events: auto;
                user-select: auto;
                position: relative;
                z-index: 1000;
            "
        ></div>

        <script src="./civ-selector.js"></script>
        <script>
            // IPC communication for interactive state
            const { ipcRenderer } = require("electron");

            let interactiveTimeout;

            ipcRenderer.on("make-interactive", () => {
                console.log("Making window interactive");
                document.body.style.pointerEvents = "auto";
                document.body.style.userSelect = "auto";

                // Clear any existing timeout
                if (interactiveTimeout) {
                    clearTimeout(interactiveTimeout);
                }

                // Show drag handle
                const dragHandle = document.getElementById("drag-handle");
                dragHandle.style.display = "block";

                // Show visual feedback
                const feedback = document.createElement("div");
                feedback.id = "interactive-feedback";
                feedback.textContent = "Window is interactive for 5 seconds...";
                feedback.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(0, 255, 0, 0.8);
                    color: white;
                    padding: 10px;
                    border-radius: 5px;
                    z-index: 10000;
                    font-family: Arial, sans-serif;
                    font-size: 14px;
                `;
                document.body.appendChild(feedback);
            });

            ipcRenderer.on("make-non-interactive", () => {
                console.log("Making window non-interactive");
                document.body.style.pointerEvents = "none";
                document.body.style.userSelect = "none";

                // Hide drag handle
                const dragHandle = document.getElementById("drag-handle");
                dragHandle.style.display = "none";

                // Remove visual feedback
                const feedback = document.getElementById(
                    "interactive-feedback"
                );
                if (feedback) {
                    feedback.remove();
                }
            });

            // No custom drag functionality needed - using CSS -webkit-app-region: drag
        </script>
        <script>
            // Usage example
            const civs = [
                { code: "ARM", name: "Armenians" },
                { code: "AZT", name: "Aztecs" },
                { code: "BENG", name: "Bengalis" },
                { code: "BER", name: "Berbers" },
                { code: "BOH", name: "Bohemians" },
                { code: "BRI", name: "Britons" },
                { code: "BUL", name: "Bulgarians" },
                { code: "BURGU", name: "Burgundians" },
                { code: "BUR", name: "Burmese" },
                { code: "BYZ", name: "Byzantines" },
                { code: "CEL", name: "Celts" },
                { code: "CHI", name: "Chinese" },
                { code: "CUM", name: "Cumans" },
                { code: "DRAV", name: "Dravidians" },
                { code: "ETH", name: "Ethiopians" },
                { code: "FRK", name: "Franks" },
                { code: "GEO", name: "Georgians" },
                { code: "GOT", name: "Goths" },
                { code: "GURJ", name: "Gurjaras" },
                { code: "HIN", name: "Hindustanis" },
                { code: "HUN", name: "Huns" },
                { code: "INC", name: "Inca" },
                { code: "ITA", name: "Italians" },
                { code: "JAP", name: "Japanese" },
                { code: "JUR", name: "Jurchens" },
                { code: "KHI", name: "Khitans" },
                { code: "KHM", name: "Khmer" },
                { code: "KOR", name: "Koreans" },
                { code: "LIT", name: "Lithuanians" },
                { code: "MAG", name: "Magyars" },
                { code: "MALY", name: "Malay" },
                { code: "MAL", name: "Malians" },
                { code: "MAY", name: "Maya" },
                { code: "MON", name: "Mongols" },
                { code: "PER", name: "Persians" },
                { code: "POL", name: "Poles" },
                { code: "POR", name: "Portuguese" },
                { code: "ROM", name: "Romans" },
                { code: "SAR", name: "Saracens" },
                { code: "SHU", name: "Shu" },
                { code: "SIC", name: "Sicilians" },
                { code: "SLV", name: "Slavs" },
                { code: "SPN", name: "Spanish" },
                { code: "TAT", name: "Tatars" },
                { code: "TEU", name: "Teutons" },
                { code: "TUR", name: "Turks" },
                { code: "VIE", name: "Vietnamese" },
                { code: "VIK", name: "Vikings" },
                { code: "WEI", name: "Wei" },
                { code: "WU", name: "Wu" },
            ];

            // Load civilization data
            let civData = [];

            fetch("./civ-info.json")
                .then((response) => response.json())
                .then((data) => {
                    civData = data;
                    console.log(
                        "Loaded civ data:",
                        data.length,
                        "civilizations"
                    );
                })
                .catch((error) => {
                    console.error("Error loading civ data:", error);
                });

            // Initialize the civilization selector
            console.log("Initializing civ-selector...");
            console.log("Mount element:", document.getElementById("app"));
            console.log("CivSelect available:", window.CivSelect);

            window.civSelectInstance = window.CivSelect.init({
                mount: document.getElementById("app"),
                civs: civs,
                value: null,
                onChange: function (civ) {
                    console.log("Selected civilization:", civ);
                    displayCivInfo(civ, civData);
                },
            });

            console.log("Civ-selector initialized:", window.civSelectInstance);

            // Function to display civilization information
            function displayCivInfo(selectedCiv, allCivData) {
                const civInfoDiv = document.getElementById("civ-info");
                const appDiv = document.getElementById("app");

                if (!selectedCiv || !allCivData) {
                    civInfoDiv.style.display = "none";
                    appDiv.style.display = "block";
                    return;
                }

                const civ = allCivData.find((c) => c.code === selectedCiv.code);
                if (!civ) {
                    civInfoDiv.style.display = "none";
                    appDiv.style.display = "block";
                    return;
                }

                // Hide the civ selector and show civ info
                appDiv.style.display = "none";
                civInfoDiv.style.display = "block";

                let html = `
                    <div style="background: rgba(0, 0, 0, 0.8); padding: 20px; border: 1px solid rgba(255, 255, 255, 0.2);">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <button id="back-button" style="
                                background: none;
                                border: none;
                                color: #ffd700;
                                font-size: 20px;
                                cursor: pointer;
                                margin-right: 10px;
                                padding: 5px;
                                transition: color 0.2s;
                            " title="Back to civ selector">‚Üê</button>
                            <h2 style="margin: 0; color: #ffd700; font-size: 24px;">${
                                civ.name
                            }</h2>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong style="color: #ffd700;">Focus:</strong> ${
                                civ.focus
                            }
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong style="color: #ffd700;">Team Bonus:</strong> ${
                                civ.teamBonus
                            }
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong style="color: #ffd700;">Civilization Bonuses:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                ${civ.civilizationBonuses
                                    .map((bonus) => `<li>${bonus}</li>`)
                                    .join("")}
                            </ul>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong style="color: #ffd700;">Unique Units:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                ${civ.uniqueUnits
                                    .map(
                                        (unit) =>
                                            `<li><strong>${unit.name}:</strong> ${unit.description}</li>`
                                    )
                                    .join("")}
                            </ul>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong style="color: #ffd700;">Unique Technologies:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                ${civ.uniqueTechnologies
                                    .map(
                                        (tech) =>
                                            `<li><strong>${tech.name}:</strong> ${tech.description}</li>`
                                    )
                                    .join("")}
                            </ul>
                        </div>
                `;

                if (civ.uniqueBuildings) {
                    html += `
                        <div style="margin-bottom: 15px;">
                            <strong style="color: #ffd700;">Unique Buildings:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                ${civ.uniqueBuildings
                                    .map(
                                        (building) =>
                                            `<li><strong>${building.name}:</strong> ${building.description}</li>`
                                    )
                                    .join("")}
                            </ul>
                        </div>
                    `;
                }

                html += "</div>";

                civInfoDiv.innerHTML = html;

                // Add event listener for back button
                const backButton = document.getElementById("back-button");
                if (backButton) {
                    backButton.addEventListener("click", () => {
                        // Show civ selector and hide civ info
                        appDiv.style.display = "block";
                        civInfoDiv.style.display = "none";

                        // Clear the current selection
                        if (window.civSelectInstance) {
                            window.civSelectInstance.value = null;
                            window.civSelectInstance.input.value = "";
                        }
                    });

                    // Add hover effect
                    backButton.addEventListener("mouseenter", () => {
                        backButton.style.color = "#ffffff";
                    });

                    backButton.addEventListener("mouseleave", () => {
                        backButton.style.color = "#ffd700";
                    });
                }
            }
        </script>
    </body>
</html>
